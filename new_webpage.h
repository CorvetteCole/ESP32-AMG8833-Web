static const char canvas_htm[] PROGMEM = "<!DOCTYPE html><html><head><style>#thermcam td{width:30;height:30}</style> <script>var Socket;var streamframestimer;var sizesensor=[24,24];var minTsensor=0.0;var maxTsensor=80.0;var minT=15.0;var maxT=40.0;var currentFrame=[];var minTframe=maxTsensor;var maxTframe=minTsensor;var minTframelocation=[0,0];var maxTframelocation=[0,0];var camColors=['1500BF','0900BF','0003C0','0010C0','001DC1','002AC2','0037C2','0044C3','0052C3','005FC4','006DC5','007AC5','0088C6','0095C6','00A3C7','00B1C8','00BFC8','00C9C4','00C9B8','00CAAB','00CB9E','00CB90','00CC83','00CC76','00CD68','00CE5B','00CE4D','00CF40','00CF32','00D024','00D116','00D109','05D200','13D200','21D300','2FD400','3DD400','4CD500','5AD500','69D600','78D700','86D700','95D800','A4D800','B3D900','C2DA00','D1DA00','DBD500','DBC700','DCB900','DDAA00','DD9C00','DE8E00','DE7F00','DF7100','E06200','E05300','E14400','E13500','E22600','E31700','E30800','E40006','E50015',];function mapto(val,minin,maxin,minout,maxout){if(val>=maxin){return maxout;}else if(val<=minin){return minout;}else{return((((maxout-minout)/(maxin-minin))*val)+(minout-((maxout-minout)/(maxin-minin))*minin));}} function adjusttemrange(range,adjustment){if(range=='min'){if(adjustment==0){minT=minTframe;}else{minT+=adjustment;}} if(range=='max'){if(adjustment==0){maxT=maxTframe;}else{maxT+=adjustment;}} if(minT<minTsensor){minT=minTsensor;} if(maxT>maxTsensor){maxT=maxTsensor;} if(minT>=maxT){minT=maxT-1.0;} fillthermcamtable(currentFrame);document.getElementById('minT').innerHTML=minT.toFixed(2)+'C';document.getElementById('maxT').innerHTML=maxT.toFixed(2)+'C';} function ctof(tempc){return(tempc*(9/5))+32;} function buildthermcamtable(){var thermcamTable=document.getElementById('thermcam');for(i=0;i<sizesensor[0];i++){var row=thermcamTable.insertRow(i);for(j=0;j<sizesensor[1];j++){var cell=row.insertCell(j);cell.id='tccell'+((i*24)+j);}}} function fillthermcamtable(pixelarray){minTframe=maxTsensor;maxTframe=minTsensor;for(i=0;i<sizesensor[0];i++){for(j=0;j<sizesensor[1];j++){var idx=((i*24)+j);var cell=document.getElementById('tccell'+idx);var camcolorvalue=Math.round(mapto(pixelarray[idx],minT,maxT,0,63));cell.innerHTML=pixelarray[idx].toFixed(2)+'C '+ctof(pixelarray[idx]).toFixed(2)+'F';cell.style.backgroundColor='#'+camColors[camcolorvalue];cell.className='camcolorvalue'+camcolorvalue;if(pixelarray[idx]<minTframe){minTframe=pixelarray[idx];minTframelocation=[j,i];} if(pixelarray[idx]>maxTframe){maxTframe=pixelarray[idx];maxTframelocation=[j,i];}}} document.getElementById('minTframedata').innerHTML=minTframe.toFixed(2)+'C '+ctof(minTframe).toFixed(2)+'F ('+minTframelocation[0]+','+minTframelocation[1]+')';document.getElementById('maxTframedata').innerHTML=maxTframe.toFixed(2)+'C '+ctof(maxTframe).toFixed(2)+'F ('+maxTframelocation[0]+','+maxTframelocation[1]+')';} function init(){buildthermcamtable();document.getElementById('minT').innerHTML=minT.toFixed(2)+'C';document.getElementById('maxT').innerHTML=maxT.toFixed(2)+'C';let url='ws://thermal.local:81';if(typeof ipAddress!=='undefined'){url='ws://'+ipAddress+':81';} let connection=new WebSocket(url);connection.onopen=function(){connection.send('Ping');};connection.onerror=function(error){console.log('WebSocket Error '+error);};connection.onmessage=function(e){if(e.data[0]=='['){currentFrame=JSON.parse(e.data);fillthermcamtable(currentFrame);}};} let avgHighTemp=0;let avgLowTemp=0;let highTarget=-100;let lowTarget=200;let high=-100;let low=200;let counter=30;</script> </head><body onload='init()'><table id='thermcam'></table><hr/><table id='thermcamcontrols'><tr><td>Min Temp</td><td id='minT'></td><td><button type='button' onclick=\"adjusttemrange('min',-5);\">-5C</button></td><td><button type='button' onclick=\"adjusttemrange('min',-1);\">-1C</button></td><td><button type='button' onclick='adjusttemrange('min', 0);'>lowest in current frame</button></td><td><button type='button' onclick=\"adjusttemrange('min',+1);\">+1C</button></td><td><button type='button' onclick=\"adjusttemrange('min',+5);\">+5C</button></td><td id='minTframedata'></td></tr><tr><td>Max Temp</td><td id='maxT'></td><td><button type='button' onclick=\"adjusttemrange('max',-5);\">-5C</button></td><td><button type='button' onclick=\"adjusttemrange('max',-1);\">-1C</button></td><td><button type='button' onclick='adjusttemrange('max', 0);'>highest in current frame</button></td><td><button type='button' onclick=\"adjusttemrange('max',+1);\">+1C</button></td><td><button type='button' onclick=\"adjusttemrange('max',+5);\">+5C</button></td><td id='maxTframedata'></td></tr></table><hr/><div> <button type='button' >Get Frame</button> <button type='button' >Start Stream Frames</button> <button type='button' >Stop Stream Frames</button></div><p id='ip'></p></body> <script>if(typeof ipAddress!=='undefined'){document.getElementById('ip').innerText='IP: '+ipAddress;}</script> </html>";  
